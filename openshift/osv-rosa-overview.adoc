---
sidebar: sidebar 
permalink: openshift/osv-rosa-overview.html 
keywords: OpenShift, OCP, Trident, NetApp ONTAP, Red Hat OpenShift, OpenShift Virtualization, ROSA, CNV, Container Native Virtualization, Red Hat OpenShift Virtualization 
summary: ROSA 上的 Red Hat OpenShift 虛擬化 
---
= 在 ROSA 叢集上部署具有 FSx for ONTAP 的Red Hat OpenShift 虛擬化
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
將Amazon FSx for NetApp ONTAP設定為 ROSA（AWS 上的 Red Hat OpenShift 服務）叢集的預設 StorageClass。此過程包括建立利用 FSx ONTAP儲存作為其磁碟區的 VM、檢查為 VM 建立的所有物件以及使用來賓憑證連接到 VM。

我們還將研究使用來賓憑證連接到虛擬機，並重新啟動虛擬機。最後，我們將虛擬機器從目前節點即時遷移到新節點。我們將檢查虛擬機器重新啟動和即時遷移後的磁碟儲存內容。



== 先決條件

* link:https://signin.aws.amazon.com/signin?redirect_uri=https://portal.aws.amazon.com/billing/signup/resume&client_id=signup["AWS 帳號"]
* link:https://console.redhat.com/["Red Hat 帳號"]
* IAM 用戶link:https://www.rosaworkshop.io/rosa/1-account_setup/["具有適當的權限"]建立並存取ROSA集群
* link:https://aws.amazon.com/cli/["AWS CLI"]
* link:https://console.redhat.com/openshift/downloads["ROSA CLI"]
* link:https://console.redhat.com/openshift/downloads["OpenShift 命令列介面"]（oc）
* link:https://docs.aws.amazon.com/eks/latest/userguide/helm.html["Helm 3 文檔"]
* link:https://docs.openshift.com/rosa/rosa_hcp/rosa-hcp-sts-creating-a-cluster-quickly.html["HCP ROSA 集群"]（至少有 3 個裸機工作節點）
* link:https://console.redhat.com/openshift/overview["造訪 Red Hat OpenShift Web 控制台"]
* Trident 25.02 或更高版本 有關上述Trident先決條件，請參閱link:osv-trident-install.html["Trident安裝部分"]了解詳情。
* link:https://docs.redhat.com/en/documentation/openshift_container_platform/4.17/html/virtualization/installing#virt-aws-bm_preparing-cluster-for-virt["在 ROSA 叢集上安裝 OpenShift 虛擬化"]


從Trident 25.02 版本開始，您可以輕鬆準備 ROSA 叢集（或任何 OpenShift 叢集）的工作節點以在 FSxN 儲存體上執行 iSCSI 作業。有兩種簡單的方法可以安裝Trident 25.02（或更高版本），以自動為 iSCSI 準備工作節點。在安裝 OpenShift Virtualization 之前，您應該已經建立了 trident 後端、儲存類別和磁碟區快照類別物件並將它們設為預設值。您可以參考link:osv-trident-install.html["Trident安裝部分"]了解詳情。



== 初始設定

設定 trident 後端、儲存類別和 VolumeSnapshotClass。您可以參考link:osv-trident-install.html["Trident安裝部分"]了解詳情。

建立 Trident 後端物件的範例 yaml

[source, yaml]
----
cat tbc.yaml
apiVersion: v1
kind: Secret
metadata:
  name: backend-tbc-ontap-san-secret
type: Opaque
stringData:
  username: fsxadmin
  password: <password for the fsxN filesystem>
---
apiVersion: trident.netapp.io/v1
kind: TridentBackendConfig
metadata:
  name: backend-tbc-ontap-san
spec:
  version: 1
  storageDriverName: ontap-san
  managementLIF: <management lif of fsxN filesystem>
  backendName: backend-tbc-ontap-san
  svm: svm_FSxNForROSAiSCSI
  credentials:
    name: backend-tbc-ontap-san-secret

cat sc.yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: trident-csi
provisioner: csi.trident.netapp.io
parameters:
  backendType: "ontap-san"
  media: "ssd"
  provisioningType: "thin"
  snapshots: "true"
allowVolumeExpansion: true

cat snapshot-class.yaml
apiVersion: snapshot.storage.k8s.io/v1
kind: VolumeSnapshotClass
metadata:
  name: fsx-snapclass
driver: csi.trident.netapp.io
deletionPolicy: Retain

#oc create -f tbc,yaml -n trident
#oc create -f sc.yaml
#oc create -f snapshot-class.yaml
----
在安裝 OpenShift Virtualization 之前，請確保儲存類別和磁碟區快照類別已配置為預設值。有關如何設定預設值的詳細信息，您可以參考link:osv-trident-install.html["使用Trident儲存和快照類別設定預設值部分"]了解詳情。



=== **從範本建立虛擬機器**

使用 Web 控制台從範本建立 VM。從 AWS 主控台上的 RedHat OpenShiftService 建立一個虛擬機器。叢集上有可用的範本可用於建立虛擬機器。在下面的螢幕截圖中，我們從這個清單中選擇了 fedora VM。為虛擬機器命名，然後按一下**自訂虛擬機器**。選擇**磁碟**選項卡並按一下**新增磁碟**。最好將磁碟名稱變更為有意義的名稱，確保選擇 **trident-csi** 作為儲存類別。點選**儲存**。點選**建立虛擬機器**

幾分鐘後，虛擬機器處於運作狀態image:redhat-openshift-ocpv-rosa-003.png["OCP-v 從範本建立虛擬機"]

image:redhat-openshift-ocpv-rosa-004.png["OCP-v 模板來源可用"]

image:redhat-openshift-ocpv-rosa-005.png["OCP-v 自訂虛擬機"]

image:redhat-openshift-ocpv-rosa-006.png["OCP-v 磁碟選項卡"]

image:redhat-openshift-ocpv-rosa-007.png["OCP-v 新增磁碟"]

image:redhat-openshift-ocpv-rosa-008.png["OCP-v VM 正在運行"]



=== **檢查為虛擬機器建立的所有物件**

存儲磁碟。image:redhat-openshift-ocpv-rosa-009.png["OCP-v 儲存磁碟"]

VM 的檔案系統將顯示分割區、檔案系統類型和掛載點。image:redhat-openshift-ocpv-rosa-010.png["OCP-v 檔案系統"]

為虛擬機器建立 2 個 PVC，一個來自啟動磁碟，一個來自熱插拔磁碟。image:redhat-openshift-ocpv-rosa-011.png["OCP-v 虛擬機器 PVC"]

啟動磁碟的 PVC 顯示存取模式為 ReadWriteMany，儲存類別為 trident-csi。image:redhat-openshift-ocpv-rosa-012.png["OCP-v VM啟動磁碟PVC"]

類似地，熱插拔磁碟的 PVC 顯示存取模式為 ReadWriteMany，儲存類別為 trident-csi。image:redhat-openshift-ocpv-rosa-013.png["OCP-v VM熱插拔磁碟PVC"]

在下面的螢幕截圖中，我們可以看到虛擬機器的 pod 狀態為正在運作。image:redhat-openshift-ocpv-rosa-014.png["OCP-v VM 正在運行"]

在這裡我們可以看到與 VM pod 關聯的兩個磁碟區以及與它們關聯的 2 個 PVC。image:redhat-openshift-ocpv-rosa-015.png["OCP-v VM PVC 和 PV"]



=== **連接到虛擬機器**

按一下「開啟 Web 控制台」按鈕，然後使用來賓憑證登入image:redhat-openshift-ocpv-rosa-016.png["OCP-v VM 連接"]

image:redhat-openshift-ocpv-rosa-017.png["OCP-v 登入"]

發出以下命令

[source]
----
$ df (to display information about the disk space usage on a file system).
----
[source]
----
$ dd if=/dev/urandom of=random.dat bs=1M count=10240 (to create a file called random.dat in the home dir and fill it with random data).
----
磁碟上存有 11 GB 的資料。image:redhat-openshift-ocpv-rosa-018.png["OCP-v VM 填充磁碟"]

使用 vi 建立我們將用於測試的範例文字檔案。image:redhat-openshift-ocpv-rosa-019.png["OCP-v建立文件"]

**相關部落格**

link:https://community.netapp.com/t5/Tech-ONTAP-Blogs/Unlock-Seamless-iSCSI-Storage-Integration-A-Guide-to-FSxN-on-ROSA-Clusters-for/ba-p/459124["解鎖無縫 iSCSI 儲存整合：iSCSI ROSA 叢集上的 FSxN 指南"]

link:https://community.netapp.com/t5/Tech-ONTAP-Blogs/Simplifying-Trident-Installation-on-Red-Hat-OpenShift-with-the-New-Certified/ba-p/459710["使用新認證的Trident Operator 簡化 Red Hat OpenShift 上的Trident安裝"]
