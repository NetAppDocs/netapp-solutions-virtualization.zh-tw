---
sidebar: sidebar 
permalink: proxmox/proxmox-ontap-fc.html 
keywords: netapp, proxmox, proxmox ve, fc, fibre channel, lvm, ontap, storage 
summary: '使用ONTAP為 Proxmox 虛擬環境設定邏輯磁碟區管理器 (LVM) 和光纖通道。此程序包括多路徑配置、LUN 配置、igroup 設定和共用儲存的磁碟區組建立。' 
---
= 為 Proxmox VE 配置 LVM 和 FC
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
使用光纖通道協定和NetApp ONTAP配置 Proxmox 虛擬環境 (VE) 主機之間的共用儲存的邏輯磁碟區管理器 (LVM)。這種配置能夠實現高效能、低延遲的區塊級儲存存取。



== 初始虛擬化管理員任務

完成這些初始任務，為 Proxmox VE 主機準備 FC 連接，並收集儲存管理員所需的必要資訊。

. 確認是否有兩個HBA介面可用。
. 確保所有 Proxmox VE 主機上都安裝了 multipath-tools，並且開機啟動。
+
[source, shell]
----
apt list | grep multipath-tools
# If need to install, execute the following line.
apt-get install multipath-tools
systemctl enable --now multipathd
----
+

NOTE: ONTAP 裝置多重路徑所需的組態已包含在套件中。如需詳細資訊，請參閱 link:https://docs.netapp.com/us-en/ontap-sanhost/hu-proxmox-ve-9x.html#step-1-confirm-the-multipath-configuration-for-your-host["關於 Proxmox VE 9.x for FCP 和 iSCSI 與 ONTAP 儲存的 ONTAP 9 文件"]

. 收集所有 Proxmox VE 主機的 WWPN 並將其提供給儲存管理員。
+
[source, shell]
----
cat /sys/class/fc_host/host*/port_name
----




== 儲存管理員任務

如果您是ONTAP新手，請使用系統管理員以獲得更好的體驗。

. 確保SVM可用且已啟用FC協定。跟隨 link:https://docs.netapp.com/us-en/ontap/san-admin/provision-storage.html["ONTAP 9 文件"]。
. 每個控制器會建立兩個專用於 FC 的 LIF。
+
image:proxmox-ontap-fc-001.png["FC介面詳情"]

. 建立 igroup 並填入主機 FC 發起程序。
. 在 SVM 上建立所需大小的 LUN，並將其呈現給上一個步驟所建立的 igroup。確保在ASA系統的「安全性」標籤上啟用反勒索軟體保護，並在AFF/ FAS系統的「磁碟區安全」標籤上啟用反勒索軟體保護。
+
image:proxmox-ontap-fc-002.png["lun詳情"]

. 通知虛擬化管理員 LUN 已建立。




== 最終虛擬化管理員任務

完成以下任務，將 LUN 設定為 Proxmox VE 中的共用 LVM 儲存體。

. 在叢集中的每個 Proxmox VE 主機上導航至 shell，並驗證磁碟是否可見。
+
[source, shell]
----
lsblk -S
rescan-scsi-bus.sh
lsblk -S
----
. 確認設備是否出現在多路徑清單中。
+
[source, shell]
----
multipath -ll
multipath -a /dev/sdX  # replace sdX with the device name
multipath -r
multipath -ll
----
. 建立卷宗組。
+
[source, shell]
----
vgcreate <volume group name> /dev/mapper/<device id>
# Where <volume group name> is the desired name for the volume group and <device id> is the multipath device id.
pvs
# Verify the physical volume is part of the volume group.
vgs
# Verify the volume group is created.
----
. 使用管理使用者介面 `https:<proxmox node>:8006`按一下“資料中心”，選擇“儲存”，按一下“新增”，然後選擇“LVM”。
+
.顯示範例
[%collapsible]
====
image:proxmox-ontap-fc-003.png["lvm儲存導航"]

====
. 提供儲存 ID 名稱，選擇現有磁碟區組，然後選擇剛剛使用 CLI 建立的磁碟區組。勾選共享選項。使用 Proxmox VE 9 及更高版本，啟用下列功能： `Allow Snapshots as Volume-Chain` 啟用「進階」複選框後，此選項才會顯示。
+
.顯示範例
[%collapsible]
====
image:proxmox-ontap-fc-004.png["lvm儲存創建"]

====
. 下面展示了使用 FC 的 LVM 的範例儲存設定檔：
+
.顯示範例
[%collapsible]
====
image:proxmox-ontap-fc-005.png["lvm fc 配置"]

====
+
在 Proxmox VE 9 及更高版本中，儲存設定檔包含以下附加選項 `snapshot-as-volume-chain 1` 什麼時候 `Allow Snapshots as Volume-Chain` 已啟用。


