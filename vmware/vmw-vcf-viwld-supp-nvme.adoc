---
sidebar: sidebar 
permalink: vmware/vmw-vcf-viwld-supp-nvme.html 
keywords: netapp, vmware, cloud, foundation, vcf, aff, all-flash, nfs, vvol, vvols, array, ontap tools, otv, sddc, iscsi 
summary:  
---
= 將 NVMe over TCP 作為補充儲存新增至 VI 工作負載域
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
在此用例中，我們概述了使用ONTAP Tools for VMware 將 NVMe over TCP (NVMe/TCP) 配置為 VMware Cloud Foundation (VCF) 虛擬基礎架構 (VI) 工作負載域的補充儲存的過程。此過程總結了設定支援 NVMe/TCP 的儲存虛擬機器 (SVM)、建立 NVMe 命名空間、配置 ESXi 主機網路以及部署 VMFS 資料儲存區。



== NVMe over TCP 的優勢

*高效能：*以低延遲和高資料傳輸速率提供卓越的效能。這對於要求嚴格的應用程式和大規模資料操作至關重要。

*可擴充性：*支援可擴充配置，讓 IT 管理員隨著資料需求的成長無縫擴展其基礎架構。

*成本效益：*在標準乙太網路交換器上運作並封裝在 TCP 資料報內。無需特殊設備即可實施。

有關 NVMe 優勢的更多信息，請參閱 https://www.netapp.com/data-storage/nvme/what-is-nvme/["什麼是 NVME？"]



== 場景概述

此場景涵蓋以下進階步驟：

* 建立具有邏輯介面 (LIF) 的儲存虛擬機器 (SVM)，用於 NVMe/TCP 流量。
* 為 VI 工作負載域上的 iSCSI 網路建立分散式連接埠群組。
* 在 ESXi 主機上為 VI 工作負載域建立 iSCSI 的 vmkernel 適配器。
* 在 ESXi 主機上新增 NVMe/TCP 轉接器。
* 部署 NVMe/TCP 資料儲存。




== 先決條件

此場景需要以下組件和配置：

* ONTAP AFF或ASA儲存系統，乙太網路交換器上具有專用於儲存流量的實體資料連接埠。
* VCF管理網域部署已完成，並且可以存取vSphere客戶端。
* 之前已部署 VI 工作負載域。


NetApp建議對 NVMe/TCP 採用完全冗餘的網路設計。下圖說明了冗餘配置的範例，為儲存系統、交換器、網路適配器和主機系統提供容錯功能。請參閱NetApplink:https://docs.netapp.com/us-en/ontap/san-config/index.html["SAN 配置參考"]了解更多。

image:vmware-vcf-asa-074.png["NVMe-tcp網路設計"]

對於跨多路徑的多路徑和故障轉移， NetApp建議在 NVMe/TCP 配置中，所有 SVM 的單獨乙太網路中每個儲存節點至少有兩個 LIF。

本文檔示範了建立新 SVM 和指定 IP 位址資訊以便為 NVMe/TCP 流量建立多個 LIF 的過程。若要將新的 LIF 新增至現有 SVM，請參閱link:https://docs.netapp.com/us-en/ontap/networking/create_a_lif.html["建立 LIF（網路介面）"]。

有關ONTAP儲存系統的 NVMe 設計注意事項的更多信息，請參閱link:https://docs.netapp.com/us-en/ontap/nvme/support-limitations.html["NVMe 配置、支援和限制"]。



== 部署步驟

若要使用 NVMe/TCP 在 VCF 工作負載域上建立 VMFS 資料存儲，請完成下列步驟。



=== 在ONTAP儲存系統上建立 SVM、LIF 和 NVMe 命名空間

以下步驟在ONTAP系統管理員中執行。

.建立儲存虛擬機器和 LIF
[%collapsible%open]
====
完成以下步驟，為 NVMe/TCP 流量建立一個 SVM 以及多個 LIF。

. 從ONTAP系統管理員導覽到左側選單中的 *儲存虛擬機器*，然後按一下 *+ 新增* 開始。
+
image:vmware-vcf-asa-001.png["點擊“+新增”開始建立 SVM"]

+
{nbsp}

. 在“新增儲存虛擬機器”精靈中，為 SVM 提供“名稱”，選擇“IP 空間”，然後在“存取協定”下按一下“NVMe”標籤並選取“啟用 NVMe/TCP”複選框。
+
image:vmware-vcf-asa-075.png["新增儲存虛擬機器精靈 - 啟用 NVMe/TCP"]

+
{nbsp}

. 在 *網路介面* 部分填寫第一個 LIF 的 *IP 位址*、*子網路遮罩* 和 *廣播域和連接埠*。對於後續 LIF，可以啟用該複選框以在所有剩餘 LIF 中使用通用設置，或使用單獨的設置。
+

NOTE: 對於跨多路徑的多路徑和故障轉移， NetApp建議在 NVMe/TCP 配置中，所有 SVM 的單獨乙太網路中每個儲存節點至少有兩個 LIF。

+
image:vmware-vcf-asa-076.png["填寫 LIF 的網路訊息"]

+
{nbsp}

. 選擇是否啟用儲存虛擬機器管理帳戶（適用於多租用戶環境），然後按一下「*儲存*」以建立 SVM。
+
image:vmware-vcf-asa-004.png["啟用 SVM 帳戶並完成"]



====
.建立 NVMe 命名空間
[%collapsible%open]
====
NVMe 命名空間類似 iSCSi 或 FC 的 LUN。必須先建立 NVMe 命名空間，然後才能從 vSphere Client 部署 VMFS 資料儲存。若要建立 NVMe 命名空間，必須先從叢集中的每個 ESXi 主機取得 NVMe 限定名稱 (NQN)。  ONTAP使用 NQN 為命名空間提供存取控制。

完成以下步驟來建立 NVMe 命名空間：

. 開啟與叢集中的 ESXi 主機的 SSH 會話以取得其 NQN。從 CLI 使用以下命令：
+
[source, cli]
----
esxcli nvme info get
----
+
應該會顯示類似以下內容的輸出：

+
[source, cli]
----
Host NQN: nqn.2014-08.com.netapp.sddc:nvme:vcf-wkld-esx01
----
. 記錄叢集中每個 ESXi 主機的 NQN
. 從ONTAP系統管理員導覽至左側選單中的 *NVMe 命名空間*，然後按一下 *+ 新增* 開始。
+
image:vmware-vcf-asa-093.png["按一下「+新增」以建立 NVMe 命名空間"]

+
{nbsp}

. 在「新增 NVMe 命名空間」頁面上，填寫名稱前綴、要建立的命名空間數量、命名空間的大小以及將存取命名空間的主機作業系統。在 *Host NQN* 部分中，建立一個以逗號分隔的列表，其中包含先前從將存取命名空間的 ESXi 主機收集的 NQN。


按一下「更多選項」來配置其他項目，例如快照保護策略。最後，按一下「*儲存*」以建立 NVMe 命名空間。

+image:vmware-vcf-asa-093.png["按一下「+新增」以建立 NVMe 命名空間"]

====


=== 在 ESXi 主機上設定網路和 NVMe 軟體適配器

以下步驟使用 vSphere 用戶端在 VI 工作負載域叢集上執行。在這種情況下，使用 vCenter Single Sign-On，因此 vSphere 用戶端對於管理網域和工作負載網域都是通用的。

.為 NVME/TCP 流量建立分散式連接埠組
[%collapsible%open]
====
完成以下步驟為每個 NVMe/TCP 網路建立一個新的分散式連接埠群組：

. 從 vSphere 用戶端，導覽至工作負載域的 *Inventory > Networking*。導航至現有的分散式交換器並選擇建立*新分散式連接埠群組...*的操作。
+
image:vmware-vcf-asa-022.png["選擇建立新的連接埠群組"]

+
{nbsp}

. 在「新分散式連接埠群組」精靈中填寫新連接埠群組的名稱，然後按一下「下一步」繼續。
. 在*配置設定*頁面上填寫所有設定。如果正在使用 VLAN，請確保提供正確的 VLAN ID。按一下“*下一步*”繼續。
+
image:vmware-vcf-asa-023.png["填寫VLAN ID"]

+
{nbsp}

. 在*準備完成*頁面上，檢查變更並按一下*完成*以建立新的分散式連接埠群組。
. 重複此程序為正在使用的第二個 NVMe/TCP 網路建立分散式連接埠群組，並確保輸入了正確的 *VLAN ID*。
. 建立兩個連接埠組後，導覽至第一個連接埠組並選擇操作*編輯設定...*。
+
image:vmware-vcf-asa-077.png["DPG－編輯設置"]

+
{nbsp}

. 在*分散式連接埠群組 - 編輯設定*頁面上，導覽至左側選單中的*組合和故障轉移*，然後按一下*上行鏈路 2* 將其下移至*未使用的上行鏈路*。
+
image:vmware-vcf-asa-078.png["將上行鏈路 2 移至未使用狀態"]

. 對第二個 NVMe/TCP 連接埠群組重複此步驟。但是，這次將 *uplink1* 下移至 *Unused uplinks*。
+
image:vmware-vcf-asa-079.png["將上行鏈路 1 移至未使用狀態"]



====
.在每個 ESXi 主機上建立 VMkernel 適配器
[%collapsible%open]
====
在工作負載域中的每個 ESXi 主機上重複此程序。

. 從 vSphere 用戶端導覽至工作負載域清單中的其中一個 ESXi 主機。從*配置*標籤中選擇*VMkernel 適配器*，然後按一下*新增網路...*開始。
+
image:vmware-vcf-asa-030.png["啟動新增網路精靈"]

+
{nbsp}

. 在*選擇連線類型*視窗中選擇*VMkernel 網路適配器*，然後按一下*下一步*繼續。
+
image:vmware-vcf-asa-008.png["選擇 VMkernel 網路適配器"]

+
{nbsp}

. 在「選擇目標設備」頁面上，選擇先前建立的 iSCSI 分散式連接埠群組之一。
+
image:vmware-vcf-asa-095.png["選擇目標連接埠群組"]

+
{nbsp}

. 在「*連接埠屬性*」頁面上，按一下「*NVMe over TCP*」框，然後按一下「*下一步*」繼續。
+
image:vmware-vcf-asa-096.png["VMkernel 連接埠屬性"]

+
{nbsp}

. 在 *IPv4 設定* 頁面上填寫 *IP 位址*、*子網路遮罩*，並提供新的網關 IP 位址（僅在需要時）。按一下“*下一步*”繼續。
+
image:vmware-vcf-asa-097.png["VMkernel IPv4 設定"]

+
{nbsp}

. 在「準備完成」頁面上檢查您的選擇，然後按一下「完成」以建立 VMkernel 適配器。
+
image:vmware-vcf-asa-098.png["檢查 VMkernel 選擇"]

+
{nbsp}

. 重複此程序為第二個 iSCSI 網路建立 VMkernel 適配器。


====
.新增 NVMe over TCP 適配器
[%collapsible%open]
====
工作負載域叢集中的每個 ESXi 主機都必須為每個已建立的專用於儲存流量的 NVMe/TCP 網路安裝 NVMe over TCP 軟體適配器。

若要安裝 NVMe over TCP 轉接器並發現 NVMe 控制器，請完成以下步驟：

. 在 vSphere 用戶端中導覽至工作負載域叢集中的一台 ESXi 主機。從*配置*標籤中按一下選單中的*儲存適配器*，然後從*新增軟體適配器*下拉選單中選擇*新增 NVMe over TCP 適配器*。
+
image:vmware-vcf-asa-099.png["新增 NVMe over TCP 適配器"]

+
{nbsp}

. 在*新增軟體 NVMe over TCP 適配器*視窗中，存取*實體網路介面卡*下拉選單並選擇要啟用 NVMe 適配器的正確實體網路介面卡。
+
image:vmware-vcf-asa-100.png["選擇實體適配器"]

+
{nbsp}

. 對分配給 NVMe over TCP 流量的第二個網路重複此過程，並指派正確的實體適配器。
. 選擇其中一個新安裝的 NVMe over TCP 適配器，然後在「控制器」標籤上選擇「新增控制器」。
+
image:vmware-vcf-asa-101.png["新增控制器"]

+
{nbsp}

. 在*新增控制器*視窗中，選擇*自動*標籤並完成以下步驟。
+
** 填寫與指派給此 NVMe over TCP 適配器的實體適配器位於同一網路上的其中一個 SVM 邏輯介面的 IP 位址。
** 點選“發現控制器”按鈕。
** 從發現的控制器清單中，按一下網路位址與此 NVMe over TCP 適配器一致的兩個控制器的核取方塊。
** 點選“*OK*”按鈕新增選定的控制器。
+
image:vmware-vcf-asa-102.png["發現並添加控制器"]

+
{nbsp}



. 幾秒鐘後，您應該會看到 NVMe 命名空間出現在「裝置」標籤上。
+
image:vmware-vcf-asa-103.png["裝置下方列出的 NVMe 命名空間"]

+
{nbsp}

. 重複此程序為 NVMe/TCP 流量建立的第二個網路建立 NVMe over TCP 適配器。


====
.部署 NVMe over TCP 資料存儲
[%collapsible%open]
====
若要在 NVMe 命名空間上建立 VMFS 資料存儲，請完成以下步驟：

. 在 vSphere 用戶端中導覽至工作負載域叢集中的一台 ESXi 主機。從*操作*選單中選擇*儲存>新資料儲存...*。
+
image:vmware-vcf-asa-104.png["新增 NVMe over TCP 適配器"]

+
{nbsp}

. 在「新資料儲存」精靈中，選擇「VMFS」作為類型。按一下“*下一步*”繼續。
. 在*名稱和裝置選擇*頁面上，提供資料儲存的名稱，並從可用裝置清單中選擇 NVMe 命名空間。
+
image:vmware-vcf-asa-105.png["名稱和設備選擇"]

+
{nbsp}

. 在 *VMFS 版本* 頁面上選擇資料儲存的 VMFS 版本。
. 在「分區配置」頁面上，對預設分區方案進行任何所需的變更。按一下“*下一步*”繼續。
+
image:vmware-vcf-asa-106.png["NVMe 分割區配置"]

+
{nbsp}

. 在*準備完成*頁面上，查看摘要並點擊*完成*以建立資料儲存。
. 導航到清單中的新資料儲存並點擊“*主機*”標籤。如果配置正確，則應列出叢集中的所有 ESXi 主機並可以存取新的資料儲存。
+
image:vmware-vcf-asa-107.png["連接到資料儲存區的主機"]

+
{nbsp}



====


== 附加資訊

有關配置ONTAP儲存系統的信息，請參閱link:https://docs.netapp.com/us-en/ontap["ONTAP 9 文件"]中心。

有關配置 VCF 的信息，請參閱link:https://techdocs.broadcom.com/us/en/vmware-cis/vcf.html["VMware 雲端基礎文檔"]。
