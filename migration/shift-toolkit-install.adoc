---
sidebar: sidebar 
permalink: migration/shift-toolkit-install.html 
keywords: netapp, vmware, esxi, vm, migration, openshift, virtualization, hyper-v, proxmox 
summary:  
---
= 為ONTAP儲存安裝和設定 Shift Toolkit
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
使用線上或離線安裝選項在執行 Windows 作業系統的專用 VM 上安裝 Shift Toolkit。此程序包括檢查安裝需求、設定ONTAP儲存虛擬機器 (SVM)、qtree 和 CIFS 共用、下載安裝套件以及執行安裝程式。



== 準備安裝

Shift 工具包可在 Windows 2019 和 2022 版本上運作。

* 從以下位置下載 Shift 工具包link:https://mysupport.netapp.com/site/tools/tool-eula/netapp-shift-toolkit["NetApp工具箱"]
* 解壓縮包
* 運行exe安裝並啟動服務


Shift 工具包提供了 2 個包：

* 線上（大小約 130MB），以及
* 離線（大小約 1.1GB）。


顧名思義，線上安裝程式套件透過網路從 Shift 工具包擁有的 S3 儲存桶下載並安裝必要的先決條件。

image:shift-toolkit-003.png["此圖顯示輸入/輸出對話框或表示書面內容"]

線上安裝提供了便利，而離線安裝則對安裝過程提供了更多的控制。使用離線安裝包，安裝 Shift 工具包所需的所有先決條件都捆綁在套件中。離線安裝的一個主要優點是它允許在沒有網路連線的虛擬機器上安裝 Shift 工具包。


TIP: 使用適當的套件進行部署。使用離線模式時，無需修改代理設置，因為所有必需的先決條件和檔案都已捆綁。

只要來源環境和目標環境之間存在連接，Shift 工具包就可以安裝在執行 VMware 或 Microsoft Hyper-V 伺服器的虛擬機器上，最佳做法是將 Shift 工具包安裝在自己的虛擬機器上。這種方法可讓您使用單一 Shift 工具包伺服器定位不同的 Microsoft Hyper-V 伺服器或 VMware ESXi 伺服器。


NOTE: 在專用虛擬機器上安裝 Shift 工具包。



== 安裝的先決條件



=== 硬體需求

確保 Shift 伺服器主機符合最低硬體需求。

硬體需求：

* CPU：4 個 vCPU
* 記憶體：至少 8 GB
* 磁碟空間：至少 100 GB



NOTE: 必須有 650 MB 可用磁碟空間才能安裝。



=== 連接要求

* 確保虛擬機器管理程式和儲存環境已配置，以便 Shift 工具包可以與環境中的所有元件正確互動。
* Shift 工具包必須安裝在獨立的 Windows 伺服器（實體或虛擬）上。
* Shift 伺服器、 Data ONTAP CIFS 伺服器和 Hyper-V 伺服器必須位於同一個 Windows Active Directory 網域中。
* 進行 VM 轉換時，支援將多個 CIFS 和 NFS LIF 與儲存虛擬機器一起使用。  Hyper-V 伺服器和 ESXi 主機透過這些 LIF 的 IP 位址存取儲存虛擬機器 (SVM)。
* 對於 CIFS 操作，Windows 網域控制站和NetApp儲存控制器的時間設定必須同步。




== ONTAP儲存配置



=== 建立新的 SVM（建議）

儘管 Shift 工具包允許使用現有的 SVM，但建立新的 SVM 是NetApp 的最佳實務。使用 Storage vMotion 將要遷移或轉換的虛擬機器移至位於專用Data ONTAP儲存虛擬機器 (SVM) 上的新的指定 NFS v3 資料儲存庫。此基於 svmotion 的遷移無需虛擬機器停機即可執行。透過這種方法，指定要遷移的虛擬機器不會駐留在生產 SVM 上。使用ONTAP CLI、 NetApp PowerShell 工具包或系統管理員建立新的 SVM。

請按照此處提供的步驟link:https://docs.netapp.com/us-en/ontap/networking/create_svms.html["關聯"]配置一個允許 NFS 和 SMB 協定的新 SVM。


NOTE: 建立新的 SVM 是一種很好的做法，以確保 SVM 符合 Shift 工具包要求，而不必以可能造成破壞的方式修改生產 SVM。


NOTE: 對於 Hyper-V 遷移，新的 SVM 應該同時啟用 NFS 和 SMB 協定。所配置的磁碟區也應啟用 NFS 和 SMB。如果目標是基於 KVM 的虛擬機器管理程序，則 SVM 必須啟用 NFS 協定。



=== qtree 要求

應在用於託管從 VMware 轉換為 Hyper-V 的虛擬機器的磁碟區上建立 qtree，以便隔離和儲存 VHDX 檔案或用於將從 VMDK 轉換的 qcow2 或 VHDX 檔案。

* 對於 ESX 到 Hyper-V 的轉換，Shift 工具包將轉換後的 VHDX 放置在同一磁碟區內的 qtree（具有 NTFS 安全樣式）上。
* 對於 ESX VMDK 到 QCOW2 的轉換，應使用具有 UNIX 安全樣式的 qtree。


Shift 工具包不會驗證 qtree 的安全模式。因此，根據目標虛擬機器管理程式和磁碟類型建立具有適當安全樣式的 qtree 非常重要。


NOTE: 目標路徑必須與來源虛擬機器位於同一磁碟區上。


NOTE: 依據目標虛擬機器管理程式類型和磁碟格式為 qtree 指派正確的安全樣式。


NOTE: 如果轉換後的 qcow2 檔案旨在用於 OpenShift 虛擬化，則有一個例外：這些檔案可以直接放在磁碟區上，而無需使用 qtree。為了實現這一點，使用 Shift 工具包 API 將 VMDK 檔案轉換為 qcow2 格式並將其直接放置在磁碟區中。

請按照此處提供的步驟link:https://docs.netapp.com/us-en/ontap/nfs-config/create-qtree-task.html["關聯"]建立具有正確安全模式的 qtree。

image:shift-toolkit-004.png["此圖顯示輸入/輸出對話框或表示書面內容"]



=== CIFS 共用要求：

對於 Hyper-V 遷移，建立一個共用來儲存轉換後的 VM 資料。確保 NFS 共用（用於儲存要轉換的虛擬機器）和目標共用（用於儲存轉換後的虛擬機器）位於同一磁碟區上。  Shift 工具包不支援跨越多個磁碟區。

請按照此處提供的步驟link:https://docs.netapp.com/us-en/ontap/smb-config/create-share-task.html["關聯"]建立具有適當屬性的共用。確保選擇持續可用性屬性以及其他預設屬性。

image:shift-toolkit-005.png["此圖顯示輸入/輸出對話框或表示書面內容"]

image:shift-toolkit-006.png["此圖顯示輸入/輸出對話框或表示書面內容"]


NOTE: 必須啟用 SMB 3.0，預設啟用。


NOTE: 確保啟用持續可用屬性。


NOTE: 必須在儲存虛擬機器 (SVM) 上停用 SMB 的匯出策略


NOTE: CIFS 伺服器和 Hyper-V 伺服器所屬的網域必須同時允許 Kerberos 和 NTLMv2 驗證。


NOTE: ONTAP使用 Windows 預設共用權限「所有人/完全控制」建立共用。



== 支援的作業系統

確保使用支援的 Windows 和 Linux 客戶作業系統版本進行轉換，並且 Shift 工具包支援ONTAP版本。

*支援的 VM 客戶作業系統*

以下版本的 Windows 可作為 VM 轉換的客戶作業系統：

* Windows 10
* Windows 11
* Windows 伺服器 2016
* Windows 伺服器 2019
* Windows 伺服器 2022
* Windows 伺服器 2025


以下版本的 Linux 可作為 VM 轉換的客戶作業系統：

* CentOS Linux 7.x
* Red Hat Enterprise Linux 6.7 或更高版本
* Red Hat Enterprise Linux 7.2 或更高版本
* Red Hat Enterprise Linux 8.x
* 紅帽企業 Linux 9.x
* Ubuntu 2018
* Ubuntu 2022
* Ubuntu 2024
* Debian 10
* Debian 11
* Debian 12
* Suse 12
* Suse 15



NOTE: CentOS Linux/RedHat 不支援 Red Hat Enterprise Linux 5。


NOTE: Windows Server 2008 不受支持，但轉換過程應該可以正常運作。請自行承擔風險；但是，我們收到了成功使用 Shift 工具包轉換 Windows 2008 VM 的客戶報告。遷移後更新 IP 位址非常重要，因為用於自動指派 IP 的 PowerShell 版本與 Windows Server 2008 上執行的舊版本不相容。

*支援的ONTAP版本 *

Shift 工具包支援運行ONTAP 9.14.1 或更高版本的平台

*支援的虛擬機器管理程式版本*

VMware：Shift 工具包已針對 vSphere 7.0.3 及更高版本進行驗證 Hyper-V：Shift 工具包已針對在 Windows Server 2019、Windows Server 2022 和 Windows Server 2025 上執行的 Hyper-V 角色進行驗證


NOTE: 在目前版本中，僅 Hyper-V 支援端對端虛擬機器遷移。


NOTE: 在目前版本中，對於以 KVM 為目標，VMDK 到 qcow2 的轉換是唯一支援的工作流程。因此，如果從下拉式選單中選擇了 KVM，則不需要虛擬機器管理程式詳細資訊。  qcow2 磁碟可用於在 KVM 變體上設定虛擬機器。



== 安裝

. 下載link:https://mysupport.netapp.com/site/tools/tool-eula/netapp-shift-toolkit["Shift工具包"]並解壓縮。
+
image:shift-toolkit-007.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 雙擊下載的 .exe 檔案啟動 Shift 工具包安裝。
+
image:shift-toolkit-008.png["此圖顯示輸入/輸出對話框或表示書面內容"]

+

NOTE: 所有預檢查均已執行，如果不符合最低要求，則會顯示相應的錯誤或警告訊息。

. 安裝程式將開始安裝程序。選擇適當的位置或使用預設位置，然後按一下「下一步」。
+
image:shift-toolkit-009.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 安裝程式將提示選擇用於存取 Shift 工具包 UI 的 IP 位址。
+
image:shift-toolkit-010.png["此圖顯示輸入/輸出對話框或表示書面內容"]

+

NOTE: 如果虛擬機器指派了多個 NIC，則設定程序允許使用下拉選項選擇正確的 IP 位址。

. 在此步驟中，安裝程式將顯示所有必要的元件，這些元件將作為該過程的一部分自動下載和安裝。以下是 Shift 工具包正常運作所需安裝的必要元件 - MongoDB、Windows PowerShell 7、 NetApp ONTAP PowerShell 工具包、政策檔案編輯器、憑證管理、VMware.PowerCLI 套件和 Java OpenJDK，它們都包含在套件中。
+
按一下“下一步”

+
image:shift-toolkit-011.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 查看 JAVA OpenJDK GNU 授權資訊。按一下“下一步”。
+
image:shift-toolkit-012.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 保留建立桌面捷徑的預設設置，然後按一下「下一步」。
+
image:shift-toolkit-013.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 安裝程式現已準備好繼續安裝。按一下“安裝”。
+
image:shift-toolkit-014.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 安裝開始，過程將下載所需的元件並安裝它們。完成後，按一下“完成”。
+
image:shift-toolkit-015.png["此圖顯示輸入/輸出對話框或表示書面內容"]




NOTE: 如果 Shift 工具包 VM 沒有互聯網，離線安裝程式將執行相同的步驟，但將使用執行檔中包含的套件安裝元件。

image:shift-toolkit-016.png["此圖顯示輸入/輸出對話框或表示書面內容"]


NOTE: 安裝可能需要 8-10 分鐘。



== 執行升級

下載link:https://mysupport.netapp.com/site/tools/tool-eula/netapp-shift-toolkit/download["升級包"]從“更新”開始並按照以下步驟操作：

image:shift-toolkit-017.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 將檔案解壓縮到指定資料夾。
. 解壓縮完成後，停止NetApp Shift 服務。
. 將解壓縮資料夾中的所有檔案複製到安裝目錄，並在出現提示時覆寫這些檔案。
. 完成後，使用「以管理員身分執行」選項執行 update.bat，並在出現提示時輸入 Shift Toolkit VM IP。
. 此程序將升級並啟動 Shift 服務。

