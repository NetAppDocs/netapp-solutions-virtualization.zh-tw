---
sidebar: sidebar 
permalink: migration/shift-toolkit-conversion.html 
keywords: netapp, vmware, esxi, vm, migration, openshift, virtualization, hyper-v, proxmox 
summary:  
---
= 使用 Shift Toolkit 轉換虛擬機
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
使用 Shift Toolkit 將 VMware ESX 虛擬機器磁碟 (VMDK) 轉換為 Microsoft Hyper-V (VHDX) 磁碟格式或 Red Hat KVM (QCOW2) 磁碟格式。此過程包括設定資源群組、建立轉換藍圖和安排轉換。



== 概況

Shift 工具包支援虛擬機器管理程式之間對下列磁碟格式進行虛擬磁碟的磁碟級轉換：

* VMware ESX 到 Microsoft Hyper-V（VMDK 到 VHDX）
* Microsoft Hyper-V 到 VMware ESX（VHDX 到 VMDK）
* VMware ESX 到 Red Hat KVM（VMDK 到 QCOW2）
* VMware ESX 到 Red Hat KVM（VMDK 到 RAW）


轉換後的 qcow2 檔案與任何 KVM 虛擬機器管理程式相容。例如，可以使用 virt-manager 在基於 RHEL 的 KVM 中使用 qcow2 檔案來建立虛擬機，也可以使用 ubuntu KVM、基於 Rocky Linux 的 KVM 等。經過調整後，它可以與 Oracle Linux 虛擬化管理器一起使用，也可以在使用NetApp Trident導入後與 OpenShift 虛擬化一起使用。目標是提供磁碟（以秒到分鐘為單位），然後可以將其整合到組織用於配置虛擬機器和分配網路的現有自動化腳本中。這種方法有助於減少整體遷移時間，其中磁碟轉換由 Shift 工具包 API 處理，其餘腳本啟動虛擬機器。

Shift 工具包支援從 VMware 到其他相容的 KVM 虛擬機器管理程式的端對端遷移。但是，轉換選項使遷移管理員能夠運行這些轉換和遷移 API。



== 轉換為 QCOW2 格式

若要使用NetApp Shift 工具包將虛擬磁碟轉換為 QCOW2 格式，請依照下列進階步驟操作：

* 建立目標站點類型，指定 KVM（僅轉換）為虛擬機器管理程式。
+

NOTE: KVM 不需要虛擬機器管理程式詳細資訊。

+
image::shift-toolkit-150.png[建立目標網站步驟的對話框]

* 建立包含需要進行磁碟轉換的虛擬機器的資源群組
+
image::shift-toolkit-151.png[建立資源組步驟的對話框]

+
image::shift-toolkit-152.png[建立資源組步驟的對話框]

+
image::shift-toolkit-153.png[建立資源組步驟的對話框]

* 建立將虛擬磁碟轉換為QCOW2格式的藍圖。
+
image::shift-toolkit-154.png[建立藍圖步驟的對話框]

+
image::shift-toolkit-155.png[建立藍圖步驟的對話框]

+
image::shift-toolkit-156.png[建立藍圖步驟的對話框]

* 使用調度選項指定一個時間段。如果要臨時執行轉換，請不要選取調度選項。
+
image::shift-toolkit-157.png[日程安排選項步驟的對話框]

* 藍圖建立完成後，將觸發 prepareVM 作業。該作業會自動在來源虛擬機器上執行腳本，使其做好轉換準備。這些腳本會移除 VMware Tools 並更新驅動程式以滿足目標虛擬機器管理程式的要求。
+
image::shift-toolkit-158.png[準備虛擬機器步驟的對話框]

* 一旦 prepareVM 作業成功完成（如下面的螢幕截圖所示），與虛擬機器關聯的虛擬機器磁碟就可以進行轉換，並且藍圖狀態將更新為「活動」。
* 為虛擬機器安排所需的停機時間後，按一下「轉換」。
+
image::shift-toolkit-159.png[轉換虛擬機器步驟的對話框]

* 轉換操作使用時間點快照。如果需要，請關閉虛擬機，然後重新觸發操作。
+
image::shift-toolkit-160.png[用於驗證是否關閉虛擬機器步驟的對話框]

* 轉換操作針對虛擬機器和對應的磁碟執行每個操作以產生適當的格式。
+
image::shift-toolkit-161.png[轉換 VM 步驟的結果對話框]

* 透過手動建立虛擬機器並將磁碟附加到虛擬機器來使用轉換後的磁碟。
+
image::shift-toolkit-162.png[手動轉換磁碟步驟對話框]




NOTE: Shift 工具包僅支援 qcow2 格式的磁碟轉換。它不支援虛擬機器創建或註冊。若要使用轉換後的磁碟，請手動建立虛擬機器並附加磁碟。



== 轉換為 VHDX 格式

若要使用NetApp Shift 工具包將虛擬磁碟轉換為 VHDX 格式，請依照下列進階步驟操作：

* 建立目標網站類型並指定 Hyper-V 為虛擬機器管理程式。
* 建立包含需要進行磁碟轉換的虛擬機器的資源群組
+
image::shift-toolkit-163.png[建立資源組步驟的對話框]

+
image::shift-toolkit-164.png[建立資源組步驟的對話框]

* 建立將虛擬磁碟轉換為VHDX格式的藍圖。一旦藍圖建立完成，準備工作就會自動啟動。
+
image::shift-toolkit-165.png[建立藍圖步驟的對話框]

* 一旦安排了虛擬機器所需的停機時間，請選擇「轉換」。
+
image::shift-toolkit-166.png[轉換步驟的對話框]

* 轉換操作針對虛擬機器和對應的磁碟執行每個操作以產生適當的 VHDX 格式。
+
image::shift-toolkit-167.png[轉換步驟的對話框]

* 透過手動建立虛擬機器並將磁碟附加到虛擬機器來使用轉換後的磁碟。
+
image::shift-toolkit-168.png[轉換步驟的對話框]




NOTE: 若要在 VM 中使用轉換後的 VHDX 磁碟，必須透過 Hyper-V 管理員或 PowerShell 命令手動建立 VM，並且必須將磁碟連接到該 VM。除此之外，還應手動映射網路。



== 轉換為 RAW 格式

若要使用NetApp Shift 工具包將虛擬磁碟轉換為 RAW 格式，請依照下列進階步驟操作：

* 建立目標站點類型，指定 OpenShift 或 OLVM 作為虛擬機器管理程式。
* 建立包含需要進行磁碟轉換的虛擬機器的資源群組
+
image::shift-toolkit-169.png[建立資源組步驟的對話框]

+
image::shift-toolkit-170.png[建立資源組步驟的對話框]

+
image::shift-toolkit-171.png[建立資源組步驟的對話框]

* 建立將虛擬磁碟轉換為RAW格式的藍圖。一旦藍圖建立完成，準備工作就會自動啟動。
+
image::shift-toolkit-172.png[建立藍圖步驟的對話框]

* 一旦安排了虛擬機器所需的停機時間，請選擇「轉換」。
+
image::shift-toolkit-173.png[轉換步驟的對話框]

* 轉換操作針對虛擬機器和對應的磁碟執行每個操作以產生適當的 RAW 格式。
+
image::shift-toolkit-174.png[轉換步驟的對話框]

* 手動建立虛擬機，使用轉換後的磁碟。
+
** 對於 OpenShift，使用 tridentctl 將磁碟區匯入為 PVC，然後使用匯入的磁碟建立虛擬機器。
** 對於 OLVM，請前往 ovirt 引擎 URL，並將 Shift 工具包轉換後的 RAW 檔案作為作業系統磁碟附加到虛擬機，從而建立一個新的虛擬機。請務必選擇合適的介面。
+

NOTE: 對於 OLVM，也可以使用 qcow2 檔案格式。此項目選擇可在建立藍圖時進行。

+
image::shift-toolkit-175.png[編輯轉換計劃步驟的對話框]

+

NOTE: 若要在虛擬機器中使用轉換後的 RAW 磁碟映像，必須透過 OpenShift 控制台或 OC 命令手動建立虛擬機器（透過 YAML 為 OpenShift 建立），或使用 OLVM REST API/UI 為 OLVM 創建，並且必須將磁碟附加到虛擬機器。除此之外，還應手動映射網路。

+

NOTE: 手動建立虛擬機器時，請確保指定正確的啟動類型（EFI 或 BIOS）。




