---
sidebar: sidebar 
permalink: migration/shift-toolkit-ui.html 
keywords: netapp, vmware, esxi, vm, migration, openshift, virtualization, hyper-v, proxmox 
summary:  
---
= 配置NetApp Shift 工具包
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
配置 Shift Toolkit 以自動化虛擬機器的遷移或轉換）此過程包括新增來源站點和目標站點、配置儲存、將虛擬機器分組為資源組、建立遷移藍圖以及安排遷移。



== 運行 Shift 工具包

* 使用瀏覽器，透過輸入以下命令來存取 Shift 工具包 UI： `http://<IP address specified during installation>:3001`
+

NOTE: 使用 Google Chrome 或 Internet Explorer 可獲得最佳體驗。

* 使用以下預設憑證存取使用者介面：使用者名稱：admin 密碼：admin
+
image::shift-toolkit-050.png[NetApp Shift Toolkit 登入畫面示意圖]

+

NOTE: 管理員需要在首次登入時更改其憑證。

+

NOTE: 強制更改密碼後，管理員也可以登入 GUI，使用「更改密​​碼」選項更改其憑證。

+
image::shift-toolkit-051.png[NetApp Shift Toolkit 變更密碼畫面示意圖]

+
完成後，點擊「接受並繼續」接受最終使用者許可協議。

+
image::shift-toolkit-052.png[NetApp最終用戶授權協議 (EULA) 截圖]





== Shift Toolkit 配置

在正確配置了來源虛擬機器和目標虛擬機器的儲存和連接後，即可開始配置 Shift 工具包，利用FlexClone功能自動將虛擬機器遷移或轉換為適當的格式。



=== 新增站點

第一步是發現並新增來源虛擬機器管理程式詳細資訊（包括虛擬機器管理程式和儲存），然後將來源虛擬機器管理程式詳細資訊新增至 Shift 工具包。在支援的瀏覽器中開啟 Shift 工具包，使用預設使用者名稱和密碼，然後按一下「新增網站」。

image::shift-toolkit-053.png[Shift Toolkit 新增網站對話框]


NOTE: 也可以使用「發現」選項新增網站。

新增以下平台：



==== 來源

* 來源站點詳細信息
+
** 網站名稱- 提供網站的名稱
** 虛擬機器管理程式 – 選擇 VMware 或 Hyper-V 作為來源
** 網站位置 – 選擇預設選項
** 連接器 – 選擇預設選擇




填寫完成後，按一下「繼續」。

image::shift-toolkit-054.png[Shift Toolkit 新增網站對話框]

* 如果選擇 VMware，請輸入來源 vCenter 的詳細資料。
+
** 端點 - 輸入 vCenter 伺服器的 IP 位址或 FQDN
** 使用者名稱 - 存取 vCenter 的使用者名稱（UPN 格式：username@domain.com）
** vCenter 密碼 – 用於存取 vCenter 以執行資源清單的密碼。
** vCenter SSL 指紋（選購）


* 如果選擇的是 Hyper-V，請輸入來源 Hyper-V 詳細資料。
+
** 端點 - 輸入獨立主機或故障轉移叢集端點的 IP 位址或 FQDN。
** Hyper-V 使用者名稱 - 用於存取 Hyper-V 的使用者名稱（採用下級登入名稱（網域\使用者名稱）或 UPN 格式）
** Hyper-V 密碼 – 用於存取 Hyper-V 以執行資源清點的密碼。
+
 Select “Accept Self signed certificate” and click Continue.


* ONTAP儲存系統憑證


image::shift-toolkit-055.png[Shift Toolkit 新增網站對話框]

一旦新增，Shift 工具包將執行自動發現並顯示虛擬機器以及相關的元資料資訊。Shift 工具包將自動偵測虛擬機器使用的網路和 VLAN，並填滿它們。


NOTE: 如果對來源網站進行了任何修改，請確保執行發現以獲取最新資訊。您可以點擊網站名稱旁邊的三個點，然後點擊「發現網站」來完成此操作。


NOTE: VM 庫存每 24 小時自動刷新一次。

image::shift-toolkit-056.png[使用 Shift Toolkit 的「新增站點」對話方塊來發現站點]

若要查看特定來源虛擬機器管理程式的發現數據，請前往儀表板，按一下對應網站名稱旁的「查看虛擬機器清單」。該頁面將顯示虛擬機器清單以及虛擬機器屬性。

image::shift-toolkit-057.png[Shift Toolkit 發現網站的對話]

下一步是新增目標虛擬機器管理程式。若要新增，請點擊“新增網站”，然後選擇“目標”。



==== 目的地

image::shift-toolkit-058.png[Shift Toolkit 新增網站對話方塊（目標位置）]

* 目的地詳情
+
** 網站名稱- 提供網站的名稱
** 虛擬機器管理程式 – 從下列選項中選擇適當的目標平台：
+
*** VMware
*** Hyper-V
*** OpenShift
*** OLVM
*** KVM（僅限轉換）


** 網站位置 – 選擇預設選項
** 連接器 – 選擇預設選擇




填寫完成後，按一下「繼續」。

image::shift-toolkit-059.png[Shift Toolkit 新增網站對話框，用於顯示目標詳細資訊]

根據虛擬機器管理程序的選擇，填寫必要的詳細資訊。

* 目標虛擬機器管理程序詳情
+
** 對應的虛擬機器管理程式管理員端點 IP 位址或 FQDN
** 使用者名稱 - 用於存取的使用者名稱（UPN 格式：username@domain.com 或 domain\administrator） 密碼 - 用於執行資源清點的存取密碼。




選擇“接受自簽名憑證”。

* 完成後，點擊「建立網站」。



NOTE: 來源和目標儲存系統應該相同，因為磁碟格式轉換發生在磁碟區層級和同一磁碟區內。

image::shift-toolkit-060.png[Shift Toolkit 新增網站對話框，用於顯示目標詳細資訊]

下一步是將所需的虛擬機器作為資源組分組到其遷移組。



=== 資源分組

新增平台後，將要遷移或轉換的虛擬機器分組到資源組。  Shift 工具包資源群組可讓您將從屬虛擬機器集分組為包含其啟動順序和啟動延遲的邏輯群組。


NOTE: 在建立資源組之前，請確保已配置 Qtree（如先決條件部分所述）。

若要開始建立資源組，請點選「建立新資源組」選單項目。

. 造訪資源組，點選「建立新資源組」。
+
image::shift-toolkit-061.png[建立新資源群組使用者介面的對話框]

. 在「新資源組」中，從下拉式功能表中選擇來源站點，然後按一下「建立」。
. 提供資源組詳細資訊並選擇工作流程。工作流程提供了兩個選項
+
.. 基於複製的遷移－執行從來源虛擬機器管理程式到目標虛擬機器管理程式的端對端虛擬機器遷移。
.. 基於複製的轉換 - 將磁碟格式轉換為所選的虛擬機器管理程式類型。
+
image::shift-toolkit-062.png[建立新資源群組使用者介面的對話框]



. 點擊“繼續”
. 使用搜尋選項選擇合適的虛擬機器。預設篩選選項為「資料儲存」。
+

NOTE: 在轉換之前，將虛擬機器移動以進行轉換或遷移到新建立的ONTAP SVM 上的指定資料儲存庫。這有助於隔離生產 NFS 資料存儲，並且指定的資料存儲可用於暫存虛擬機器。

+

NOTE: 對於 OpenShift 環境，應將 VMDK 遷移到其對應的捲，以使用ONTAP NAS 儲存驅動程式複製 PVC（持久性磁碟區聲明）結構。在未來的版本中，我們將加入更多增強功能，以充分利用ONTAP NAS 經濟型驅動程式。

+
image::shift-toolkit-063.png[建立新資源群組使用者介面的對話框]

+

NOTE: 此上下文中的資料儲存下拉式選單將僅顯示 NFSv3 資料儲存。NFSv4 資料儲存將不會顯示。

+
image::shift-toolkit-064.png[建立新資源群組使用者介面的對話框]

. 透過選擇「目標網站」、「目標虛擬機器管理程式項目」和資料儲存到 Qtree 或儲存類別對應來更新遷移詳細資訊。
+
image::shift-toolkit-065.png[建立新資源群組使用者介面的對話框]

+

NOTE: 轉換虛擬機器時，請確保目標路徑（儲存轉換後的虛擬機器的位置）設定為 qtree。將目標路徑設定為對應的 qtree。

+

NOTE: 可以建立多個 qtree 並用於相應地儲存轉換後的 VM 磁碟。

+

NOTE: 虛擬機器可以在跨儲存區上運行，Shit 工具包會自動偵測到它們，但是每個磁碟區都應該映射一個 qtree。

+
能夠將具有跨多個磁碟區的 VMDK 的虛擬機器遷移 Shift 工具包 UI 會自動選擇屬於特定 RG 的虛擬機器或虛擬機器的所有跨磁碟機。這將列出 RG 頁面中所有捲，我們在該頁面進行資料儲存 - qtree 映射。

+
image::shift-toolkit-066.png[建立新資源群組使用者介面的對話框]

. 為所有選定的虛擬機器選擇啟動順序和啟動延遲（秒）。透過選擇每個虛擬機器並設定其優先順序來設定開機順序。3 是所有虛擬機器的預設值。選項如下：1 – 第一台啟動的虛擬機；3 – 預設值；5 – 最後啟動的虛擬機
+
image::shift-toolkit-067.png[建立新資源群組使用者介面的對話框]

. 點選「建立資源組」。
+
image::shift-toolkit-068.png[建立新資源群組使用者介面的對話框]

+

NOTE: 如果需要修改資源組以新增或刪除虛擬機，請使用此選項並選擇資源組名稱，然後選擇「編輯資源組」。





=== 藍圖

要遷移或轉換虛擬機，必須制定計劃。從下拉式選單中選擇來源和目標虛擬機器管理程式平台，並選擇要包含在此藍圖中的資源群組，以及應用程式啟動方式的分組（即網域控制器，然後是第 1 層，然後是第 2 層，等等）。這些通常也被稱為遷移計劃。若要定義藍圖，請導覽至「藍圖」選項卡，然後按一下「建立新藍圖」。

若要開始建立藍圖，請點選「建立新藍圖」。

. 造訪藍圖，點選「建立新藍圖」。
+
image::shift-toolkit-069.png[存取藍圖使用者介面的對話框]

. 在「新藍圖」中，為計畫命名，並透過選擇來源網站 > 關聯的 vCenter、目標網站和關聯的虛擬機器管理程式來新增必要的主機對應。
. 映射完成後，選擇叢集和主機映射。在下面的範例中，Hyper-V 被顯示為目標。根據所選來源網站的不同，顯示的虛擬機器管理程式選項也會有所不同。
+
image::shift-toolkit-070.png[建立新藍圖使用者介面對話框]

. 選擇資源組詳細信息，然後點擊“繼續”。
+
image::shift-toolkit-071.png[建立新藍圖使用者介面對話框]

. 設定資源組的執行順序。當存在多個資源組時，此選項可以選擇操作順序。
. 完成前面的步驟後，選擇網路映射並將其指派給對應的網路映射。確保目標虛擬機器管理程式上已設定虛擬交換器、網路設定檔或電信業者。
+
image::shift-toolkit-072.png[建立新藍圖使用者介面對話框]

+

NOTE: 對於測試遷移，「不配置網路」是預設選擇，Shift 工具包不會執行 IP 位址分配。磁碟轉換完成後，在相應的虛擬機管理程式端購買虛擬機，手動分配氣泡網路交換機，以避免與生產網路發生任何衝突。

+
image::shift-toolkit-073.png[建立新藍圖使用者介面對話框]

. 根據虛擬機器的選擇，將自動選擇儲存映射。
+

NOTE: 請確保事先配置 qtree 並分配必要的權限，以便建立虛擬機器並啟動它。注意：對於 OpenShift，PVC 是使用Trident CSI 建立的，無需預先建立 qtree。

. 在虛擬機器詳細資料下，為每種作業系統類型提供服務帳戶和有效使用者憑證。這用於連接到虛擬機器以建立和執行刪除 VMware 工具和備份 IP 配置詳細資訊所需的某些腳本。
+
.. 對於基於 Windows 的作業系統，建議使用具有本機管理員權限的使用者。也可以使用網域憑證，但是請確保在轉換之前虛擬機器上存在使用者設定文件，否則網域憑證將無法運作，因為它會在沒有網路連線時查找網域驗證。
.. 對於基於 Linux 發行版的客戶虛擬機，提供一個無需密碼即可執行 sudo 命令的用戶，這意味著該用戶應該屬於 sudoers 列表，或者作為新的配置文件添加到 /etc/sudoers.d/ 資料夾中。
+
image::shift-toolkit-074.png[建立新藍圖使用者介面對話框]

+
在最近發布的版本中，Shift Toolkit 在虛擬機器準備方面引入了更大的靈活性。預設情況下，工具包透過部署特定於作業系統的腳本來自動準備虛擬機，以：* 移除 VMware Tools * 備份 IP 設定以便根據所選藍圖重新分配

+
+ 透過這項新增強功能，使用者現在可以覆寫預設的 prepareVM 任務，從而能夠執行自訂腳本以手動準備 VM，包括 IP 分配。這為具有特殊配置或合規性要求的環境提供了更大的控制權。



. 再次在 VM 詳細資料下，選擇相關的 IP 配置選項。預設情況下，選擇“不配置”。
+
.. 若要將具有相同 IP 位址的虛擬機器從來源系統移轉過來，請選擇「保留 IP」。
.. 若要遷移來源系統中使用靜態 IP 位址的虛擬機，並在目標虛擬機器上指派 DHCP，請選擇「DHCP」。
+
請確保滿足以下要求才能使此功能正常運作：

+
*** 確保虛擬機器在 prepareVM 階段以及預定的遷移時間內處於開啟狀態。
*** 對於 VMware VM，請確保已安裝 VMware Tools。
*** 如果來源虛擬機器管理程式是 Hyper-V，請確保已啟用並設定整合服務。
*** 對於以 OLVM 和 OpenShift 為目標虛擬機器管理程式的情況，請確保將 virtIO ISO 檔案掛載到 Windows 虛擬機器。
*** 確保使用具有管理員權限的帳戶在來源虛擬機器上執行準備腳本（Windows 作業系統）或使用 sudo 權限且不含密碼選項的帳戶（Linux 發行版作業系統），以建立 cron 作業。




. 下一步是虛擬機器配置。
+
** 可選擇調整虛擬機器的 CPU/RAM 參數，這對於調整大小非常有幫助。
** 啟動順序覆蓋：也修改資源組中所有選定虛擬機器的啟動順序和啟動延遲（秒）。如果需要對資源組啟動順序選擇期間選擇的內容進行任何更改，這是用於修改啟動順序的附加選項。預設情況下，使用資源組選擇期間選擇的啟動順序，但可以在此階段進行任何修改。
** 開啟：如果工作流程不應開啟虛擬機，請取消選取此選項。預設選項為 ON，表示虛擬機器將開啟。
** 移除 VMware 工具：Shift 工具包在轉換後移除 VMware 工具。預設選擇此選項。如果計劃執行客戶自己的自訂腳本，則應取消選擇此項目。
** 產生：Shift 工具包使用以下經驗法則並預設為適當的規則 - Gen1 > BIOS 和 Gen2 > EFI。此選項無法選擇。
** 保留 MAC：可以保留各個虛擬機器的 MAC 位址，以克服依賴 MAC 的應用程式的授權挑戰。
** 服務帳戶覆蓋：如果無法使用全域服務帳戶，則此選項允許指定單獨的服務帳戶。
+
image::shift-toolkit-075.png[資源群組使用者介面對話框]



. 點選“繼續”。
. 在下一步中，透過選取核取方塊來設定日期和時間來安排遷移。確保所有虛擬機器 (VM) 在預定日期之前準備好並關閉。完成後，點選「建立藍圖」。
+
image::shift-toolkit-076.png[資源群組使用者介面對話框]

+

NOTE: 排程時，請選擇比目前 Shift VM 時間至少早 30 分鐘的日期。這是為了確保工作流程有足夠的時間來準備資源組內的虛擬機器。

. 建立藍圖後，將啟動 prepareVM 作業，並自動在來源虛擬機器上執行腳本以準備遷移
+
image::shift-toolkit-077.png[資源群組使用者介面對話框]

+
此作業使用invoke-VMScript方法運行腳本，複製刪除VMware工具和備份網路配置詳細資訊所需的腳本，包括IP位址、路由和DNS信息，這些資訊將用於在目標VM上維護相同的設定。

+
.. 對於基於 Windows 的作業系統，準備腳本的預設儲存位置是「C:\ NetApp」資料夾。
+
image::shift-toolkit-078.png[資源群組使用者介面對話框]

.. 對於基於 Linux 的虛擬機，準備腳本的預設儲存位置是 / NetApp和 /opt 目錄。
+
image::shift-toolkit-079.png[資源群組使用者介面對話框]

+

NOTE: 對於執行 CentOS 或 Red Hat 的 Linux 來源 VM，Shift 工具包可以智慧地自動安裝必要的 Hyper-V 驅動程式。這些驅動程式必須在磁碟轉換之前存在於來源 VM 中，以確保 VM 在轉換後能夠成功啟動。

+

NOTE: 詳細資訊請參閱link:https://access.redhat.com/solutions/3465011["將 RHEL VM 移轉到 Hyper-V 後，系統陷入 dracut 狀態"]。

+
一旦 prepareVM 作業成功完成（如下面的螢幕截圖所示），虛擬機器就可以進行遷移，並且藍圖狀態將更新為「活動」。

+
image::shift-toolkit-080.png[資源群組使用者介面對話框]

+
image::shift-toolkit-081.png[資源群組使用者介面對話框]

+
遷移將在設定的時間進行，或者可以透過點擊「遷移」選項手動啟動。




