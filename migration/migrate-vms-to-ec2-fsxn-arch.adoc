---
sidebar: sidebar 
permalink: migration/migrate-vms-to-ec2-fsxn-arch.html 
keywords: netapp, vmware, amazon, ec2, fsxn, migration, iscsi, 
summary: '本技術報告介紹如何使用 Cirrus Migrate Cloud (CMC) 的 MigrateOps「資料移動即程式碼」功能將本機 VMware vSphere VM 移轉至資料磁碟位於 FSx ONTAP iSCSI LUN 上的 Amazon EC2 執行個體。' 
---
= 將虛擬機器移轉到 Amazon EC2 的架構和需求
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
了解使用Amazon FSx for NetApp ONTAP將虛擬機器移轉到 Amazon EC2 的架構和關鍵先決條件。



== 進階架構

下圖說明了使用 CMC MigrateOps 將 VMware 上的虛擬機器磁碟 (VMDK) 資料遷移到 AWS 的高階架構：

image:migrate-ec2-fsxn-001.png["使用 FSx ONTAP將虛擬機器移轉到 Amazon EC2 架構圖"]



== 如何使用 Amazon EC2 和 FSx ONTAP iSCSI 將 VMware VM 移轉到 AWS



=== 先決條件

在開始演練步驟之前，請確保滿足以下先決條件：

*在 AWS 上*

* 一個 AWS 帳戶。這包括子網路、VPC 設定、路由表、安全規則遷移、安全群組以及負載平衡等網路的其他要求的權限。與任何遷移一樣，大部分的精力和考慮應該放在網路方面。
* 適當的 IAM 角色可讓您設定 FSx ONTAP和 Amazon EC2 執行個體。
* 允許路由表和安全群組與 FSx ONTAP通訊。
* 在適當的安全群組中新增入站規則（有關更多詳細信息，請參閱下文），以允許從本地資料中心到 AWS 的安全資料傳輸。
* 可以解析公共網際網路網域的有效 DNS。
* 檢查您的 DNS 解析是否正常並且允許您解析主機名稱。
* 為了獲得最佳效能和適當大小，請使用來源環境中的效能資料來適當調整 FSx ONTAP儲存的大小。
* 每個 MigrateOps 會話使用一個 EIP，因此應增加 EIP 的配額以實現更多的平行性。請記住，預設的 EIP 配額是 5。
* （如果正在移轉基於 Active Directory 的工作負載）Amazon EC2 上的 Windows Active Directory 網域。


*適用於 Cirrus Migrate Cloud*

* 一個 Cirrus Data Cloud 帳戶link:http://cloud.cirrusdata.com/["cloud.cirrusdata.com"]必須在使用 CMC 之前建立。必須允許透過 HTTPS 與 CDN、Cirrus Data 端點和軟體儲存庫進行出站通訊。
* 允許透過 HTTPS 協定（連接埠 443）與 Cirrus Data Cloud 服務進行通訊（出站）。
* 對於由 CMC 專案管理的主機，部署的 CMC 軟體必須啟動與 Cirrus Data Cloud 的單向外部 TCP 連線。
* 允許 TCP 協定、連接埠 443 存取 portal-gateway.cloud.cirrusdata.com（目前位址為 208.67.222.222）。
* 允許具有二進位資料有效負載（應用程式/八位元組流）的 HTTP POST 請求（透過 HTTPS 連線）。這類似於文件上傳。
* 確保 portal-gateway.cloud.cirrusdata.com 可以透過您的 DNS（或透過 OS 主機檔案）解析。
* 如果您有嚴格的規則禁止產品實例進行出站連接，則可以使用 CMC 的「管理中繼」功能，其中出站 443 連接來自單一安全的非生產主機。


*注意*：沒有任何儲存資料被傳送到 Cirrus Data Cloud 端點。僅發送管理元數據，並且可以選擇性地屏蔽它，以便不包含真實的主機名稱、磁碟區名、網路 IP。

為了將資料從本機儲存庫遷移到 AWS，MigrateOps 可以自動管理主機到主機 (H2H) 連線。這些是 CMC 用來促進遠端遷移的最佳化的、單向的、基於 TCP 的網路連線。該過程具有始終在線的壓縮和加密功能，可將流量減少多達八倍，具體取決於資料的性質。

*注意*：CMC 的設計使得在整個遷移階段沒有生產資料/I/O 離開生產網路。因此，需要來源主機和目標主機之間的直接連線。
