---
sidebar: sidebar 
permalink: migration/shift-toolkit-migration.html 
keywords: netapp, vmware, esxi, vm, migration, openshift, virtualization, hyper-v, proxmox, shift, toolkit 
summary: 使用 Shift Toolkit 在虛擬化平台之間遷移虛擬機器。該過程包括準備虛擬機器、轉換磁碟格式以及在目標環境中配置網路設定。 
---
= 使用 Shift Toolkit 遷移虛擬機
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
使用 Shift Toolkit 在虛擬化平台之間遷移虛擬機器。該過程包括準備虛擬機器、轉換磁碟格式以及在目標環境中配置網路設定。



== 支援的遷移

Shift Toolkit 透過支援下列虛擬機器管理程式之間的雙向遷移，為多虛擬機器管理程式環境提供了靈活性：

* link:shift-toolkit-migrate-esxi2hyperv.html["VMware ESXi 到 Microsoft Hyper-V"]
* link:shift-toolkit-migrate-hyperv2esxi.html["Microsoft Hyper-V 到 VMware ESXi"]
* link:shift-toolkit-migrate-esxi2olvm.html["VMware ESXi 到 Oracle Linux Virtualization Manager (OLVM)"]
* link:shift-toolkit-migrate-esxi2osv.html["VMware ESXi 到 Red Hat OpenShift 虛擬化"]




== 遷移工作流程

建立藍圖後，即可啟動遷移程序。在遷移過程中，Shift Toolkit 會執行一系列步驟來轉換磁碟格式，並依照藍圖中的定義在目標主機上建立虛擬機器。

Shift Toolkit 在遷移過程中執行下列步驟：

. 刪除藍圖中所有虛擬機器的現有快照
. 觸發來源藍圖的虛擬機器快照
. 磁碟轉換前觸發磁碟區快照
. 複製所有虛擬機器的 VMDK 並將其轉換為 VHDx 格式
. 在目標位置啟動保護群組中的虛擬機
. 在每個虛擬機器上註冊網絡
. 移除 VMware Tools，並根據作業系統類型使用觸發腳本或 cron 作業指派 IP 位址。




== 網路技巧和注意事項

規劃遷移時，請考慮以下網路需求和行為。  Shift Toolkit 會自動從來源虛擬機複製網路設定並將其重新套用至遷移的虛擬機，但 Windows 和 Linux 系統之間的介面命名和網路介面卡配置可能有所不同。

.一般要求
* 確保靜態 IP 位址可用且未指派給其他虛擬機器。


.Windows虛擬機
* 準備腳本會複製網路設定詳細資訊（IP 位址空間、閘道位址、DNS 伺服器）。
* 觸發腳本會在遷移過程中根據藍圖映射，並為單一或多個網路卡重新套用網路設定。
* 遷移後，Windows 裝置管理員可能會顯示遷移前的舊網路介面卡訊息，但這不會影響新適配器，也不會導致 IP 位址衝突。
* 升級至 v4.0 版本，即可自動從登錄機碼和裝置管理員中移除孤立的網路裝置。


.Linux虛擬機
* 準備腳本會複製網路設定詳細資訊（IP 位址空間、路由、DNS 伺服器、網路設備名稱）。
* 此腳本會識別 Linux 發行版的網路類型，並據此套用對應的 IP 設定。
* 網路重新分配腳本已配置為 cron 作業，使用 crontab 進行設置，並在啟動時觸發。
* 此腳本根據藍圖映射重新套用單一或多個網卡的網路設定。


.介面命名
* 轉換後的虛擬機器可能有類似這樣的介面名稱 `eth0`或者 `ensp0`而不是來源介面名稱（例如， `ens192`或者 `ens33`）
* 該腳本會更新網路配置詳細信息，使其與新的介面名稱相符。
* 如果使用符合 udev 符合規則的可預測名稱，且目標虛擬機器管理程式上保留了介面名稱，則腳本會跳過網路配置，移除 VMware Tools，並重新啟動虛擬機器。



NOTE: Shift Toolkit 允許覆蓋網路準備，使管理員能夠執行自訂腳本進行 IP 分配或其他配置。

.支援的網路機制
* 網路管理器
* 內特普蘭
* ifconfig
* 邪惡


Shift Toolkit 會保留藍圖中指定的 IP 位址。



== 遷移階段

以下是使用 Shift Toolkit 遷移虛擬機器時需要遵循的遷移階段。

. *準備虛擬機*：準備遷移所需的虛擬機，並驗證所有先決條件是否已完成。
. *遷移與驗證*：準備工作完成後，將 VMware 虛擬機器遷移到目標虛擬機器管理程式。
+
遷移完成後，驗證虛擬機器是否成功啟動以及資料是否已正確遷移。

. *測試遷移*：測試遷移透過將 VMDK 轉換為適當的格式，並在 qtree 上使用轉換後的虛擬磁碟檔案建立虛擬機器來模擬遷移。
+
測試遷移不包括網路映射配置，該配置應手動執行到測試網路。




NOTE: Shift Toolkit 不會變更來源虛擬機，只會複製虛擬機器準備所需的腳本。這樣可以在轉換失敗的情況下快速回滾。



== 執行遷移

若要使用藍圖中指定的設定觸發遷移工作流程，請按一下「遷移」。

image::shift-toolkit-030.png[顯示如何觸發虛擬機器遷移的對話框]

一旦啟動，工作流程就會被激活，轉換過程將按照概述的步驟註冊虛擬機器。如果藍圖中的虛擬機器未關閉電源，Shift Toolkit 會在繼續操作之前提示使用者進行正常關機。

image::shift-toolkit-031.png[遷移過程確認]


NOTE: NetApp建議從相同來源到相同目標並行觸發的轉換次數不要超過十次。

image::shift-toolkit-032.png[遷移進度]

VMDK 轉換為任何文件格式只需幾秒鐘即可完成，這是目前最快的選擇。這種方法有助於減少遷移過程中虛擬機器的停機時間。

image::shift-toolkit-033.png[磁碟轉換進度]

任務完成後，藍圖狀態將變成「遷移完成」。

image::shift-toolkit-034.png[遷移已完成狀態]
